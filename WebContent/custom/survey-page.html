
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-styles/color.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../bower_components/iron-icons/notification-icons.html">
<link rel="import" href="../bower_components/iron-icons/places-icons.html">
<link rel="import" href="../bower_components/iron-icons/image-icons.html">
<link rel="import" href="custom-icons.html">

<dom-module id="survey-page">
  <template>
    <style>
      :host {
        @apply(--paper-font-common-base);
      }
      
      :host paper-toolbar {
      	--paper-toolbar-background:#33B200;
      }
      
      :host .header {
      	@apply(--paper-font-headline);
      	color:var(--paper-blue-grey-400);
      }
      
      :host .content {
      	margin-top:16px;
      }
      
      :host .emphasis {
      	@apply(--paper-font-display2);
      }
      
      :host .avi {
      	width:32px;
      	height:32px;
      	border-radius:20%;
      	background:var(--paper-light-blue-200);
      }
      
      :host .avi {
      	color:white;
      }
      
      :host .row {
      	@apply(--layout-horizontal);
      	@apply(--layout-center);
      }
      
      :host .row > * {
      	padding:8px;
      }
      
      :host .name {
      	@apply(--paper-font-display1);
      }
      
      :host .lower-case {
      	text-transform:lowercase;
      }
      
      :host .address, :host .method {
      	@apply(--paper-font-caption);
      }
      
      :host .method {
      	text-align:center;
      }
      
      :host .big-icon {
      	--iron-icon-height: 32px;
      	--iron-icon-width: 32px;
      }
      
      :host .flex {
      	@apply(--layout-flex);
      }
      
      :host .box {
      	min-width:42px;
      }
      
      :host .bottom-border {
      	border-bottom: 1px solid rgba(200, 200, 220, 0.6);
      }
      
      /* Small only */
      
      @media screen and (max-width: 39.9375em) {
	       .content {
	      	margin:16px;
	      }
      }
      
		/* Medium and up */
		@media screen and (min-width: 40em) {
			.content {
				max-width:60%;
				margin:0px 20%;
				background:light-blue;
			}
		}
		
		
		/* Large and up */
		@media screen and (min-width: 64em) {}
		
		.slideIn {
		 animation: s 1s linear forwards;
		}
		
		@keyframes s {
			from {opacity: 0;}
			to {opacity:1;}
		}
		    
		  #page1, #page2, #page3, #page4 {
		  opacity:0;
		  }  
		  
		  .time {
		  @apply(--paper-font-subhead);
		  }
		
		.logo {
			max-height:42px;
		}
    </style>
    <paper-toolbar>
    	<div class="title">Jenny's Wedding</div>
    	<img class="logo" src="../logo-small.png">
    </paper-toolbar>
    
     <div id="page1" class="content slideIn"> 
	    <div class="header">
	    	Where are you coming from?
	    </div>
	    <paper-input required id="address" always-float-label label="Address"></paper-input>
	    <paper-input required id="city" always-float-label label="City"></paper-input>
	    <paper-input required id="postalCode" always-float-label label="Postal Code"></paper-input>
	    <paper-input required id="province" always-float-label label="Province"></paper-input>
	    <paper-input required id="country" always-float-label label="Country"></paper-input>
		
		<paper-button raised on-tap="nextPage">NEXT</paper-button>
    </div>
    
    <div id="page2" class="content"> 
	    <div class="header">
	    	Suggested Routes
	    </div>
	    <div>
	    	<div class="row bottom-border">
	    			<iron-icon class="big-icon" icon="custom-icons:evo"></iron-icon>
	    		<div class="flex">
	    			<div class="name lower-case">Evo</div>
	    		</div>
	    		<div class="box">
	    			<div class="time">20 minutes</div>
	    			<div class="address">$15</div>
	    		</div>
	    		<iron-icon icon="icons:chevron-right" on-tap="nextPage2" data-transportation="driving"></iron-icon>
	    	</div>
	    	<div class="row bottom-border">
	    			<iron-icon class="big-icon" icon="maps:directions-car"></iron-icon>
	    		<div class="flex">
	    			<div class="name lower-case">Own Car</div>
	    		</div>
	    		<div class="box">
	    			<div class="time">20 minutes</div>
	    			<div class="address">$0</div>
	    		</div>
	    		<iron-icon icon="icons:chevron-right" on-tap="nextPage2" data-transportation="driving"></iron-icon>
	    	</div>	    	
	    	<div class="row bottom-border">
	    		<iron-icon class="big-icon" icon="maps:local-taxi"></iron-icon>
	    		<div class="flex">
	    			<div class="name lower-case">Taxi</div>
	    		</div>
	    		<div class="box">
	    			<div class="time">22 minutes</div>
	    			<div class="address">$30</div>
	    		</div>
	    		<iron-icon icon="icons:chevron-right" on-tap="nextPage2" data-transportation="taxi"></iron-icon>
	    	</div>	    	
	    	
	    	<div class="row bottom-border">
	    			<iron-icon class="big-icon" icon="maps:directions-bus"></iron-icon>
	    		<div class="flex">
	    			<div class="name lower-case">Bus</div>
	    		</div>
	    		<div class="box">
	    			<div class="time">44 minutes</div>
	    			<div class="address">$2.75</div>
	    		</div>
	    		<iron-icon icon="icons:chevron-right" on-tap="nextPage2" data-transportation="public transit"></iron-icon>
	    	</div>
	    	<div class="row bottom-border">
	    			<iron-icon class="big-icon" icon="maps:directions-bus"></iron-icon>
	    		<div class="flex">
	    			<div class="name lower-case">Need Help Getting There</div>
	    		</div>
	    		<div class="box">
	    			<div class="time">?? Minutes</div>
	    			<div class="address">$??</div>
	    		</div>
	    		<iron-icon icon="icons:chevron-right"  on-tap="nextPage2" data-transportation="help"></iron-icon>
	    	</div>	    	
	    	
	    </div>
	    
	    <!--
	    <paper-radio-group selected="{{radioSelected}}">
		    <paper-radio-button name="car">Car</paper-radio-button>
		    <paper-radio-button name="taxi">Taxi</paper-radio-button>
		    <paper-radio-button name="bus">Bus</paper-radio-button>
		    <paper-radio-button name="other">Other</paper-radio-button>
		    <paper-radio-button name="none">I need help getting there!</paper-radio-button>
	    </paper-radio-group>
		<paper-button raised on-tap="nextPage2">NEXT</paper-button>
		  -->
    </div>
    
    <div id="page3" class="content"> 
	    <div class="header">
	    	Do you have room for other people?
	    </div>
	    <paper-radio-group selected="{{radioSelected}}">
		    <paper-radio-button name="yes">Yes</paper-radio-button>
		    <paper-radio-button name="no">No</paper-radio-button>
	    </paper-radio-group>
	    <paper-button raised on-tap="nextPage3">NEXT</paper-button>
		
    </div>
    
    <div id="page4" class="content"> 
	    <div class="header">
	    	REGISTRATION COMPLETE
	    </div>
    </div>
    
    <div id="page5" class="content"> 
	     <template is="dom-repeat" items="[[nearbyUserList]]">
	    	<div class="row bottom-border">
	    		<div class="flex">
	    			<div class="name lower-case">[[item.email]]</div>
	    			<div class="address">[[item.addressFrom]]</div>
	    		</div>
	    		<div class="box">
	    			<iron-icon class="big-icon" icon="[[returnIcon(item.transportation)]]"></iron-icon>
	    			<div class="method">[[item.transportation]]</div>
	    		</div>
	    	</div>
	    </template>
		
    </div>
    
  </template>
</dom-module>

<script>
  Polymer({
    is: 'survey-page',

    behaviors: [
    ],
    
    properties:{
    	palette:{
    		type:Array,
    		value:function(){
    			return [
    				"#9fa8da",
    				"#00bcd4",
    				"#f48fb1",
    				"#ff9800",
    				"#34515e",
    				"#ba68c8"
    			];
    		}
    	},
    	pages:{
    		type:Array,
    		value:function(){
    			return [
    				"page1",
    				"page2",
    				"page3",
    				"page4"
    			];
    		}
    	},
    	testItems:{
    		type:Array,
    		value:[
    			{
    				"name":"judy",
    				"method":"evo",
    				"from":"Lynn Valley, North Vancouver"
    			},
    			{
    				"name":"bob",
    				"method":"bus",
    				"from":"Langley"
    			},
    			
    			{
    				"name":"Joey",
    				"method":"",
    				"from":""
    			},
    			
    			{
    				"name":"Luna",
    				"method":"bike",
    				"from":"East Van"
    			}
    		]
    	},
    	transportation:{
    		type: "String",
    		value: ""
    	},
    	address: {
    		type: "String",
    		value: ""
    	},
    	email: {
    		type: "String",
    		value: ""
    	},
    	needRide: {
    		type: "Boolean",
    		value: false
    	},
    	nearbyUserList:{
    		type:Array,
    		value:function(){
    			return [];
    		}
    	},
    },
    
    attached:function(){
    	
    },
    
    nextPage:function(){
    	this.email = sessionStorage.email;
    	this.address = 	this.$.address.value + " " + 
    					this.$.city.value + " " +
	    				this.$.province.value + " " +
	    				this.$.postalCode.value;
    	this.$.page1.hidden = true;
    	this.$.page2.classList.add("slideIn");
    },
    
    nextPage2:function(event){
    	this.transportation = event.target.getAttribute('data-transportation')
    	if (this.transportation == "help") {
    		this.$.page2.hidden = true;
    		this.saveUser();
    		this.getNearbyGuests();
    		this.$.page5.classList.add("slideIn");
    	} else if (this.transportation == "driving" || this.transportation == "taxi") {
        	this.$.page2.hidden = true;
        	this.$.page3.classList.add("slideIn");
    	} else {
    		this.goToEndPage(this.$.page2);
    	}

    },
    nextPage3:function(event){
    	this.goToEndPage(this.$.page3);

    },
    getNearbyGuests() {
    	var _this = this;
    	$.ajax({
    		type: "POST",
    		data: {
    			"cmd":"getNearbyUsers", 
    			"eventId":"1",
    			"email" : this.email
    		},
    		url: "/2NEWhere/UserController",
    		complete: function(resp) {
    			if(resp.responseText == "true"){
    				var userData = JSON.parse(resp.responseText)
    		    	var keys = Object.keys(userData);
    		    	var userList = [];
    		    	for(var i = 0; i < keys.length; i++){
    		    		userList.push(userData[keys[i]]);
    		    	}
    		    	this.set("nearbyUserList", userList);
    			}
    		},
    		dataType: "application/json"
    	});    	
    },
    goToEndPage:function(currentPage){
    	currentPage.hidden = true;
    	this.$.page4.classList.add("slideIn");
		this.saveUser();
    },
    saveUser() {
    	var _this = this;
    	$.ajax({
    		type: "POST",
    		data: {
    			"cmd":"saveEventUser", 
    			"eventId":"1",
    			"addressFrom" : this.address,
    			"needRide" : this.needRide,
    			"email" : this.email,
    			"transportation" : this.transportation
    		},
    		url: "/2NEWhere/UserController",
    		complete: function(resp) {
    			if(resp.responseText == "true"){
    				//Do something
    			}
    		},
    		dataType: "application/json"
    	});
    },
    returnIcon:function(method){
    	var iconMap = {
    		"evo":"custom-icons:evo",
    		"bus":"maps:directions-bus",
    		"bike":"maps:directions-bike",
    		"car":"maps:directions-car"
    	};
    	return iconMap[method];
    },
    
    generateAviColour:function(palette){
    	console.log("this.pat", palette);
    	var num = Math.floor(Math.random() * (palette.length + 1)) - 1;
    	if(num < 0){
    		num = 0;
    	}
    	return "background:" + palette[num] + ";";
    }
  });
</script>
